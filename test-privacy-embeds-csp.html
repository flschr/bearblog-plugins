<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Privacy Embeds Test - CSP Method</title>

  <!-- ============================================ -->
  <!-- CRITICAL: CSP Header MUST come first!       -->
  <!-- This blocks ALL external iframes at browser -->
  <!-- level, before preload scanner runs          -->
  <!-- ============================================ -->
  <meta http-equiv="Content-Security-Policy" content="frame-src 'self' data: blob:">

  <!-- Critical inline blocker -->
  <script>
  console.log('üîí Inline blocker starting...');
  (function(){function n(e){const t=e.getAttribute('src');if(t&&t.startsWith('http')&&!e.hasAttribute('data-src')){console.log('üö´ Blocking iframe:', t);e.setAttribute('data-src',t);e.removeAttribute('src')}}function i(){document.querySelectorAll('iframe[src]').forEach(n)}const o=new MutationObserver(function(e){for(let t=0;t<e.length;t++){const r=e[t].addedNodes;for(let e=0;e<r.length;e++){const t=r[e];if(t.nodeType===1){if(t.tagName==='IFRAME'){n(t)}const a=t.querySelectorAll&&t.querySelectorAll('iframe[src]');if(a){for(let e=0;e<a.length;e++){n(a[e])}}}}}});o.observe(document.documentElement,{childList:true,subtree:true});i();window._privacyEmbedsObserver=o;console.log('‚úÖ Inline blocker active')})();
  </script>

  <!-- Main privacy-embeds script -->
  <script src="bear/privacy-embeds.js"></script>

  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
    h1 { color: #333; }
    .test-section { margin: 30px 0; padding: 20px; border: 2px solid #ddd; border-radius: 8px; }
    .media-proxy { background: #f5f5f5; border: 2px dashed #999; padding: 20px; text-align: center; border-radius: 8px; }
    .media-proxy button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; border-radius: 4px; }
    .media-proxy button:hover { background: #0056b3; }
    iframe { width: 100%; height: 400px; border: 2px solid green; }
    .instructions { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin-bottom: 20px; }
    .success { background: #d4edda; padding: 15px; border-left: 4px solid #28a745; margin-bottom: 20px; }
    .warning { background: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; margin-bottom: 20px; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
  </style>
</head>
<body>
  <h1>üîí Privacy Embeds Test - CSP Method</h1>

  <div class="success">
    <strong>‚úÖ CSP Header aktiv!</strong><br>
    Diese Seite verwendet <code>Content-Security-Policy: frame-src 'self' data: blob:</code>
  </div>

  <div class="instructions">
    <strong>Anleitung zum Testen:</strong>
    <ol>
      <li>√ñffnen Sie die Browser-Entwicklertools (F12)</li>
      <li>Gehen Sie zum <strong>Network</strong>-Tab</li>
      <li>Laden Sie die Seite neu (Strg+R / Cmd+R)</li>
      <li><strong>‚úÖ ERFOLG:</strong> Es sollten <strong>KEINE</strong> Verbindungen zu <code>youtube.com</code> oder <code>youtube-nocookie.com</code> erscheinen!</li>
      <li>Gehen Sie zum <strong>Console</strong>-Tab</li>
      <li><strong>‚ö†Ô∏è ERWARTET:</strong> Sie sehen CSP-Fehler wie:<br>
          <code style="font-size: 0.85em; display: block; margin-top: 5px; color: #721c24;">
          Refused to frame 'https://www.youtube-nocookie.com/' because it violates the following Content Security Policy directive: "frame-src 'self' data: blob:"
          </code>
      </li>
      <li><strong>Diese Fehler sind HARMLOS</strong> - sie zeigen, dass CSP korrekt funktioniert!</li>
      <li>Klicken Sie auf "Video laden" - das Video sollte perfekt laden</li>
    </ol>
  </div>

  <div class="warning">
    <strong>‚ö†Ô∏è Was die CSP-Fehler bedeuten:</strong><br>
    Die Browser-Console zeigt CSP-Verletzungen an. Das ist <strong>normal und gew√ºnscht</strong>!
    Diese Fehler bedeuten, dass der Browser versucht hat, die iframes zu laden, aber CSP sie blockiert hat.
    <strong>Das ist genau das, was wir wollen.</strong>
  </div>

  <div class="test-section">
    <h2>Test 1: YouTube Video (Standard)</h2>
    <p>Dieser iframe versucht, zu youtube.com zu verbinden. CSP blockiert dies sofort.</p>
    <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
  </div>

  <div class="test-section">
    <h2>Test 2: YouTube Video (nocookie Domain)</h2>
    <p>Auch youtube-nocookie.com wird von CSP blockiert.</p>
    <iframe src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
  </div>

  <div class="test-section">
    <h2>Test 3: Google Maps</h2>
    <p>Google Maps wird ebenfalls blockiert.</p>
    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2428.4092366126486!2d13.377684315709384!3d52.516071979809065!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47a851c655f20989%3A0x26bbfb4e84674c63!2sBrandenburger%20Tor!5e0!3m2!1sde!2sde!4v1234567890123!5m2!1sde!2sde" allowfullscreen></iframe>
  </div>

  <script>
    // Monitoring script
    console.log('üìä Monitoring f√ºr YouTube-Verbindungen aktiv...');
    console.log('');
    console.log('=== ERWARTETES ERGEBNIS ===');
    console.log('‚úÖ Network-Tab: KEINE Anfragen an youtube.com oder youtube-nocookie.com');
    console.log('‚ö†Ô∏è  Console: CSP-Fehler werden angezeigt (das ist GUT!)');
    console.log('‚úÖ Nach Klick auf "Video laden": Video l√§dt perfekt');
    console.log('');
    console.log('=== CSP FUNKTIONIERT WENN ===');
    console.log('1. Keine YouTube-Verbindungen im Network-Tab BEVOR Sie klicken');
    console.log('2. CSP-Fehler in der Console erscheinen');
    console.log('3. Videos nach Klick korrekt laden');
    console.log('');
    console.log('Falls Sie YouTube-Verbindungen im Network-Tab sehen, funktioniert CSP NICHT!');
  </script>
</body>
</html>
